<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yantsy's Cyber Blog - Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');
        body {
            background: #0d0d15;
            color: #e0e0e0;
            font-family: 'JetBrains Mono', sans-serif;
            background-image: linear-gradient(rgba(13, 13, 21, 0.9), rgba(13, 13, 21, 0.9)), url('https://api.dujin.org/bing/1920.php');
            background-attachment: fixed; background-size: cover;
        }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .neon-text { text-shadow: 0 0 8px #ff007f; }
        .editor-height { height: calc(100vh - 300px); }
        input:focus, textarea:focus { border-color: #ff007f !important; box-shadow: 0 0 10px rgba(255, 0, 127, 0.2); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const THEME_CONFIG = {
            avatar: "https://pic.rmb.bdstatic.com/bjh/events/598a6669f4c399f92e591458e0a35c60.png",
            logoName: "YANTSY.EXE",
            repoOwner: "Yantsy",
            repoName: "Yantsy.github.io",
            signature: "åœ¨ 0 ä¸ 1 çš„æµ·æ´‹é‡Œå¯»æ‰¾çœŸå®ã€‚"
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [view, setView] = useState('home');
            const [postContent, setPostContent] = useState("# æ ‡é¢˜\n\næ­£æ–‡å†…å®¹...");
            
            // GitHub ç›¸å…³çŠ¶æ€
            const [ghToken, setGhToken] = useState(localStorage.getItem('gh_token') || '');
            const [filePath, setFilePath] = useState('posts/new-article.md');
            const [isUploading, setIsUploading] = useState(false);

            const handleLogin = (e) => {
                e.preventDefault();
                if(e.target.username.value === "yantsy" && e.target.password.value === "yantsy514") {
                    setIsLoggedIn(true);
                    setShowLogin(false);
                } else { alert("éªŒè¯å¤±è´¥"); }
            };

            // ä¿å­˜ Token åˆ°æœ¬åœ°
            const saveToken = (token) => {
                setGhToken(token);
                localStorage.setItem('gh_token', token);
            };

            // --- æ ¸å¿ƒï¼šGitHub ä¸Šä¼ é€»è¾‘ ---
            const uploadToGithub = async () => {
                if (!ghToken) return alert("è¯·å…ˆé…ç½® GitHub Access Tokenï¼");
                if (!filePath) return alert("è¯·è¾“å…¥æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼");

                setIsUploading(true);
                try {
                    // 1. å°è¯•è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œéœ€è¦è·å–å…¶ sha æ‰èƒ½æ›´æ–°ï¼‰
                    let sha = null;
                    const getUrl = `https://api.github.com/repos/${THEME_CONFIG.repoOwner}/${THEME_CONFIG.repoName}/contents/${filePath}`;
                    
                    const checkRes = await fetch(getUrl, {
                        headers: { 'Authorization': `token ${ghToken}` }
                    });
                    
                    if (checkRes.ok) {
                        const fileData = await checkRes.json();
                        sha = fileData.sha; // è·å–æ—§æ–‡ä»¶çš„ SHA
                    }

                    // 2. å°†å†…å®¹è½¬æ¢ä¸ºæ»¡è¶³ Unicode çš„ Base64
                    const contentBase64 = btoa(unescape(encodeURIComponent(postContent)));

                    // 3. æäº¤ PUT è¯·æ±‚
                    const putRes = await fetch(getUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${ghToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: `Blog: update ${filePath} via Web Editor`,
                            content: contentBase64,
                            sha: sha // å¦‚æœ sha ä¸ºç©ºåˆ™æ˜¯æ–°å»ºï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™æ˜¯æ›´æ–°
                        })
                    });

                    if (putRes.ok) {
                        alert("ğŸ‰ ä¸Šä¼ æˆåŠŸï¼Github Pages ç¨åå°†è‡ªåŠ¨éƒ¨ç½²ã€‚");
                    } else {
                        const err = await putRes.json();
                        throw new Error(err.message);
                    }
                } catch (error) {
                    console.error(error);
                    alert("ä¸Šä¼ å¤±è´¥ï¼š" + error.message);
                } finally {
                    setIsUploading(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* å¯¼èˆªæ  */}
                    <nav className="px-8 py-4 flex justify-between items-center glass-card sticky top-0 z-50 border-b border-white/5">
                        <h1 className="text-xl font-bold neon-text tracking-tighter cursor-pointer" onClick={() => setView('home')}>
                            {THEME_CONFIG.logoName}
                        </h1>

                        <div className="flex items-center gap-6">
                            {isLoggedIn ? (
                                <div className="flex items-center gap-4">
                                    <button onClick={() => setView(view === 'editor' ? 'home' : 'editor')} 
                                            className={`px-4 py-1.5 rounded-full text-xs font-bold transition ${view === 'editor' ? 'bg-pink-600' : 'bg-cyan-500 text-black'}`}>
                                        <i className={`fas ${view === 'editor' ? 'fa-eye' : 'fa-pen'} mr-2`}></i>
                                        {view === 'editor' ? 'é¢„è§ˆæ¨¡å¼' : 'å†™æ–‡ç« '}
                                    </button>
                                    <div className="flex items-center gap-3 pl-4 border-l border-white/10">
                                        <div className="text-right hidden sm:block">
                                            <div className="text-sm font-bold text-pink-400">yantsy</div>
                                            <div className="text-[10px] opacity-50">{THEME_CONFIG.signature}</div>
                                        </div>
                                        <img src={THEME_CONFIG.avatar} className="w-10 h-10 rounded-full border border-pink-500/50" />
                                    </div>
                                </div>
                            ) : (
                                <button onClick={() => setShowLogin(true)} className="text-sm opacity-50 hover:opacity-100 hover:text-cyan-400">LOGIN</button>
                            )}
                        </div>
                    </nav>

                    {/* ä¸»å†…å®¹ */}
                    <main className="container mx-auto mt-8 px-4 flex-1">
                        {view === 'home' ? (
                            <div className="max-w-4xl mx-auto space-y-6">
                                <article className="glass-card p-10 rounded-3xl border-l-4 border-pink-500">
                                    <h2 className="text-3xl font-bold mb-4">Hello World</h2>
                                    <p className="opacity-70">ç‚¹å‡»å³ä¸Šè§’ç™»å½•åå³å¯å¼€å¯äº‘ç«¯ç¼–è¾‘æ¨¡å¼...</p>
                                </article>
                            </div>
                        ) : (
                            <div className="animate-fadeIn space-y-4 pb-10">
                                {/* GitHub é…ç½®æ  */}
                                <div className="glass-card p-4 rounded-2xl flex flex-wrap gap-4 items-center">
                                    <div className="flex-1 min-w-[200px]">
                                        <label className="text-[10px] text-pink-500 block mb-1">GITHUB TOKEN (PAT)</label>
                                        <input type="password" value={ghToken} onChange={(e) => saveToken(e.target.value)} 
                                               placeholder="ç²˜è´´ä½ çš„ Token" className="w-full bg-black/40 border border-white/10 rounded-lg p-2 text-xs outline-none" />
                                    </div>
                                    <div className="flex-1 min-w-[200px]">
                                        <label className="text-[10px] text-cyan-400 block mb-1">FILE PATH (æ–‡ä»¶å/è·¯å¾„)</label>
                                        <input type="text" value={filePath} onChange={(e) => setFilePath(e.target.value)} 
                                               className="w-full bg-black/40 border border-white/10 rounded-lg p-2 text-xs outline-none font-mono" />
                                    </div>
                                    <button onClick={uploadToGithub} disabled={isUploading}
                                            className="bg-white text-black px-6 py-4 rounded-xl font-bold hover:bg-pink-500 hover:text-white transition disabled:opacity-50 h-full">
                                        {isUploading ? <i className="fas fa-spinner animate-spin"></i> : "PUSH TO GITHUB"}
                                    </button>
                                </div>

                                {/* ç¼–è¾‘åŒºåŸŸ */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 editor-height">
                                    <textarea 
                                        className="w-full h-full bg-black/40 p-6 rounded-2xl font-mono text-sm outline-none border border-white/5 focus:border-cyan-500/50 resize-none"
                                        value={postContent}
                                        onChange={(e) => setPostContent(e.target.value)}
                                    />
                                    <div className="w-full h-full bg-white/[0.02] p-6 rounded-2xl overflow-auto border border-white/5">
                                        <div className="prose prose-invert max-w-none">
                                            <div className="text-[10px] text-pink-500 mb-4 font-bold tracking-widest">// PREVIEW</div>
                                            <pre className="whitespace-pre-wrap font-sans opacity-90">{postContent}</pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* ç™»å½•å¼¹çª— */}
                    {showLogin && (
                        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-[100] backdrop-blur-xl">
                            <form onSubmit={handleLogin} className="glass-card p-10 rounded-3xl w-full max-w-sm border-t-2 border-cyan-500">
                                <h2 className="text-xl font-bold mb-6 text-center tracking-widest text-cyan-500">ACCESS SYSTEM</h2>
                                <input name="username" type="text" placeholder="USER" className="w-full bg-white/5 p-4 rounded-xl mb-4 outline-none border border-white/10" />
                                <input name="password" type="password" placeholder="PASS" className="w-full bg-white/5 p-4 rounded-xl mb-8 outline-none border border-white/10" />
                                <button className="w-full bg-white text-black py-4 rounded-xl font-black uppercase tracking-widest hover:bg-cyan-500">Verify</button>
                                <button type="button" onClick={() => setShowLogin(false)} className="w-full mt-4 text-[10px] opacity-30">CANCEL</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>